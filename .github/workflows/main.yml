# Generated by `make configure`, please do not edit manually.
"jobs":
  "debugging":
    "name": "Debugging Github Action values"
    "runs-on": "ubuntu-latest"
    "steps":
    - "run": "echo onMaster? ${{ github.ref == 'refs/heads/main' && github.repository == 'zachfi/nodemanager' }}"
    - "run": "echo ${{ github.repository }}"
    - "run": "echo ${{ github.ref }}"
    - "run": "echo ${{ github.event_name }}"
  "nodemanager":
    "name": "Generate nodemanager Jsonnet library and docs"
    "needs":
    - "repos"
    "runs-on": "ubuntu-latest"
    "steps":
    - "uses": "actions/checkout@v4"
    - "id": "filter"
      "uses": "dorny/paths-filter@v3"
      "with":
        "filters": |
          workflows:
            - '.github/**'
            - 'bin/**'
            - 'Dockerfile'
            - 'go.mod'
            - 'go.sum'
            - 'jsonnet/**'
            - 'main.go'
            - 'Makefile'
            - 'pkg/**'
            - 'scripts/**'
            - 'tf/**'
            - 'libs/nodemanager/**'
    - "if": "steps.filter.outputs.workflows == 'true'"
      "uses": "actions/download-artifact@v4"
      "with":
        "name": "docker-artifact"
        "path": "artifacts"
    - "env":
        "DIFF": "true"
        "GEN_COMMIT": "${{ github.ref == 'refs/heads/main' && github.repository == 'zachfi/nodemanager' }}"
        "GIT_COMMITTER_EMAIL": "86770550+jsonnet-libs-bot@users.noreply.github.com"
        "GIT_COMMITTER_NAME": "jsonnet-libs-bot"
        "SSH_KEY": "${{ secrets.DEPLOY_KEY }}"
      "if": "steps.filter.outputs.workflows == 'true'"
      "run": "make libs/nodemanager"
  "repos":
    "name": "Create repositories"
    "runs-on": "ubuntu-latest"
    "steps":
    - "uses": "actions/checkout@v4"
    - "uses": "zendesk/setup-jsonnet@v12"
    - "env":
        "PAGES": "false"
      "run": "make tf/main.tf.json"
    - "uses": "hashicorp/setup-terraform@v3"
      "with":
        "cli_config_credentials_token": "${{ secrets.TF_API_TOKEN }}"
    - "env":
        "GITHUB_TOKEN": "${{ secrets.PAT }}"
        "TF_IN_AUTOMATION": "1"
      "if": "github.event.pull_request.head.repo.full_name == 'zachfi/nodemanager'"
      "run": "terraform init"
      "working-directory": "tf"
    - "env":
        "GITHUB_TOKEN": "${{ secrets.PAT }}"
        "TF_IN_AUTOMATION": "1"
      "if": "github.event.pull_request.head.repo.full_name == 'zachfi/nodemanager'"
      "run": "terraform validate -no-color"
      "working-directory": "tf"
    - "env":
        "GITHUB_TOKEN": "${{ secrets.PAT }}"
        "TF_IN_AUTOMATION": "1"
      "if": "github.event.pull_request.head.repo.full_name == 'zachfi/nodemanager'"
      "run": "terraform plan -no-color"
      "working-directory": "tf"
    - "env":
        "GITHUB_TOKEN": "${{ secrets.PAT }}"
        "TF_IN_AUTOMATION": "1"
      "if": "${{ github.ref == 'refs/heads/main' && github.repository == 'zachfi/nodemanager' }}"
      "run": "gh auth status"
      "working-directory": "tf"
    - "env":
        "GITHUB_TOKEN": "${{ secrets.PAT }}"
        "TF_IN_AUTOMATION": "1"
      "if": "${{ github.ref == 'refs/heads/main' && github.repository == 'zachfi/nodemanager' }}"
      "run": "terraform init && terraform apply -no-color -auto-approve"
      "working-directory": "tf"
  "repos_with_pages":
    "name": "Set up gh-pages branch"
    "needs":
    - "nodemanager"
    "runs-on": "ubuntu-latest"
    "steps":
    - "uses": "actions/checkout@v4"
    - "uses": "zendesk/setup-jsonnet@v12"
    - "env":
        "PAGES": "true"
      "run": "make tf/main.tf.json"
    - "uses": "hashicorp/setup-terraform@v3"
      "with":
        "cli_config_credentials_token": "${{ secrets.TF_API_TOKEN }}"
    - "env":
        "GITHUB_TOKEN": "${{ secrets.PAT }}"
        "TF_IN_AUTOMATION": "1"
      "if": "github.event.pull_request.head.repo.full_name == 'zachfi/nodemanager'"
      "run": "terraform init"
      "working-directory": "tf"
    - "env":
        "GITHUB_TOKEN": "${{ secrets.PAT }}"
        "TF_IN_AUTOMATION": "1"
      "if": "github.event.pull_request.head.repo.full_name == 'zachfi/nodemanager'"
      "run": "terraform validate -no-color"
      "working-directory": "tf"
    - "env":
        "GITHUB_TOKEN": "${{ secrets.PAT }}"
        "TF_IN_AUTOMATION": "1"
      "if": "github.event.pull_request.head.repo.full_name == 'zachfi/nodemanager'"
      "run": "terraform plan -no-color"
      "working-directory": "tf"
    - "env":
        "GITHUB_TOKEN": "${{ secrets.PAT }}"
        "TF_IN_AUTOMATION": "1"
      "if": "${{ github.ref == 'refs/heads/main' && github.repository == 'zachfi/nodemanager' }}"
      "run": "gh auth status"
      "working-directory": "tf"
    - "env":
        "GITHUB_TOKEN": "${{ secrets.PAT }}"
        "TF_IN_AUTOMATION": "1"
      "if": "${{ github.ref == 'refs/heads/main' && github.repository == 'zachfi/nodemanager' }}"
      "run": "terraform init && terraform apply -no-color -auto-approve"
      "working-directory": "tf"
"on":
  "pull_request":
    "branches":
    - "main"
  "push":
    "branches":
    - "main"